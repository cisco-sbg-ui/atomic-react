import {Meta, Canvas, Story, ArgsTable} from "@storybook/addon-docs/blocks";
import {useRef, useState} from "react";

import AForm from "./AForm";
import YourComponent from "../../utils/storybook-function";
import AButton from "../AButton";
import ATextInput from "../ATextInput";
import {ACol, ARow, AContainer} from "../ALayout";
import ASelect from "../ASelect";
import ATextarea from "../ATextarea";
import AAlert from "../AAlert";

<Meta title="Components/Forms" component={AForm} />

# Forms

## Install

Integrate with your build to [auto-import](?path=/docs/getting-started--page#integrating), or add an import in your component:

```
import AForm from "@cisco-ats/atomic-react/AForm"
// or if you're able to treekshake node_modules
import {AForm} from "@cisco-ats/atomic-react";
```

## Usage

<Canvas>
  <Story name="usage-1">
    <YourComponent>
      {() => {
        const [email, setEmail] = useState("");
        const [favNum, setFavNum] = useState("");
        const [errors, setErrors] = useState([]);
        const [comments, setComments] = useState("");
        const [role, setRole] = useState(null);
        const form = useRef(null);
        return (
          <AForm ref={form}>
            <AContainer>
              <ARow>
                <ACol>
                  <h3>Form</h3>
                  {errors.length > 0 && (
                    <AAlert className="my-2" level="danger" dismissable={false}>
                      There are {errors.length} validation errors on the form.
                    </AAlert>
                  )}
                </ACol>
              </ARow>
              <ARow>
                <ACol cols="12" sm="6">
                  <ATextInput
                    label="Email"
                    required
                    maxLength={50}
                    value={email}
                    onChange={(e) => {
                      setEmail(e.target.value);
                    }}
                    validateOnBlur
                    rules={[
                      {
                        test: (value) =>
                          !["@gmail.com", "@hotmail.com"].some((v) =>
                            value.includes(v)
                          ) || "Please provide a business email address",
                        level: "warning"
                      },
                      {
                        test: (value) =>
                          /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(
                            value
                          ) || "Invalid Email",
                        level: "danger"
                      }
                    ]}
                    hint="Please use a business email address"
                  />
                </ACol>
                <ACol>
                  <ASelect
                    items={[
                      {value: 1, text: "Read"},
                      {value: 2, text: "Write"},
                      {value: 3, text: "Admin"}
                    ]}
                    label="Role"
                    required
                    rules={[
                      {
                        test: (v) => v.value !== 3 || "Role is set to Admin",
                        level: "warning"
                      }
                    ]}
                    onSelected={(item) => setRole(item)}
                  />
                </ACol>
              </ARow>
              <ARow>
                <ACol>
                  <ATextarea
                    label="Comments"
                    onChange={(e) => {
                      setComments(e.target.value);
                    }}
                    value={comments}
                    required
                    rules={[
                      {
                        test: (v) =>
                          v.length < 10 ||
                          "Comments must be less than 10 characters",
                        level: "danger"
                      }
                    ]}
                    validateOnBlur
                    hint="Keep it short"
                  />
                </ACol>
              </ARow>
              <ARow>
                <ACol className="text-right">
                  <AButton
                    secondary
                    className="mr-2"
                    onClick={() => {
                      setErrors([]);
                      form.current.reset();
                    }}>
                    Reset
                  </AButton>
                  <AButton onClick={() => setErrors(form.current.validate())}>
                    Validate
                  </AButton>
                </ACol>
              </ARow>
            </AContainer>
          </AForm>
        );
      }}
    </YourComponent>
  </Story>
</Canvas>

## Props

The `AForm` component only renders children.

<ArgsTable of={AForm} />
